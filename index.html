<!DOCTYPE html>
<html>
<head>
  <title>My first Vue app</title>
<script src="https://cdn.jsdelivr.net/npm/vue@2.6.12"></script>
    <script src="script.js" defer></script>
</head>
<body>

      <div id="app">
        {{ message }}
          <br>
          <button type = "button" id = "get-joke" @click = "fetchAPIData">next</button>

            <div v-if = "responseAvailable == true">

                <hr>
                <p>

                <h3>US Headlines</h3>
                 <div id="imageContainer"></div>
                <br>
                <br>

<!--                <img id="theimage" src={{result}}  width="500px" height="500px">-->
                {{result}}

                </p>
                <hr>

            </div>
      </div>


<script>
var app = new Vue({
      el: '#app',
      data: {
           message: 'Hello Vue!',
           result : [],

          totalimg : 0,
           ApiKey: "f0d28a4d90524260bcbe604c73ddce21",
           responseAvailable: false,

      },
    methods: {
        fetchAPIData( ) {


            var url = "https://newsapi.org/v2/top-headlines?country=us&apiKey=f0d28a4d90524260bcbe604c73ddce21";
            var req = new Request(url);


            fetch(req)

                .then(response => {
                if(response.ok){
                    return response.json()
                } else{
                    alert("Server returned " + response.status + " : " + response.statusText);
                }
            })

            .then(response => {
                this.responseAvailable = true;
                this.totalimg = response.totalResults;
                console.log(this.totalimg);

                for (let i = 0; i < response.articles.length; i++) {
                //     if (response.articles[i] === null || response.articles[i] === undefined )
                //     {
                //     //     this.result[i] = response.articles[i].urlToImage ;
                //     // console.log(i,this.result[i]);
                //     }
                //     else {
                        this.result[i] = response.articles[i].urlToImage ;
                    console.log(i,this.result[i]);
                    // }

                }
                     var imgs = this.result;
                    console.log(imgs);
                    var container = document.getElementById("imageContainer");
                    var docFrag = document.createDocumentFragment();
                    imgs.forEach(function (cur, index, arr) {
                        var img = document.createElement('img');
                        img.src = cur;
                        img.style.height = "200px";
                        img.style.width = "200px";
                        img.style.padding = "5px";

                        docFrag.appendChild(img);
                    });

                    if ( docFrag != null ) {
                            container.appendChild(docFrag);
                    }



            })



            .catch(err => {
                console.log(err);
            });

            }
        }
    })
</script>


</body>
</html>
